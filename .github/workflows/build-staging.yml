name: Deploy with Docker Compose

on:
  push:
    branches:
      - actions/build-staging

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Run docker-compose up on remote host
      env:
        COMMIT_SHA: ${{ github.sha }}
        CONTAINER_NAME: "your_service"
        SSH_USERNAME: ${{ secrets.SSH_USERNAME }}
        SSH_PASSWORD: ${{ secrets.SSH_PASSWORD }}
        SSH_DESTINATION: ${{ secrets.SSH_DESTINATION }}
        SSH_PORT: ${{ secrets.SSH_PORT }}
      run: |
        docker-compose \
            -H "ssh://${{ secrets.SSH_USERNAME }}:${{ secrets.SSH_PASSWORD }}@${{ secrets.SSH_DESTINATION }}:${{ secrets.SSH_PORT }}" \
            -f ./scalar/docker-cluster-evmos.yaml \
            -p $COMMIT_SHA \
            up -d
